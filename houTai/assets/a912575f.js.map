{"version":3,"file":"a912575f.js","sources":["../../src/views/navman/navmenu.vue"],"sourcesContent":["<template>\r\n  <div class=\"page-contanier\">\r\n    <div ref=\"pageHeader\" class=\"page-header\">\r\n      <!-- <page-search></page-search> -->\r\n      <page-describe title=\"导航菜单\" desc=\"用于创建导航栏菜单\"></page-describe>\r\n    </div>\r\n    <div class=\"page-content\">\r\n      <!-- table strat -->\r\n      <page-table\r\n        :data=\"table.data\"\r\n        :columns=\"columns\"\r\n        :loading=\"table.loading\"\r\n        @on-add=\"addFormData\"\r\n        @on-refresh=\"getPageData()\"\r\n        :permission=\"{ action: 'nmenu:add' }\"\r\n      ></page-table>\r\n      <!-- table end -->\r\n    </div>\r\n    <!-- model strat -->\r\n    <page-model\r\n      v-model:visible=\"modal.visible\"\r\n      :title=\"modal.title\"\r\n      @on-save=\"saveFormData\"\r\n    >\r\n      <n-form\r\n        ref=\"formRefs\"\r\n        label-placement=\"left\"\r\n        :label-width=\"80\"\r\n        :model=\"modal.form\"\r\n        :rules=\"modal.rules\"\r\n        :show-require-mark=\"true\"\r\n      >\r\n        <n-form-item label=\"类型\" path=\"type\">\r\n          <n-radio-group v-model:value=\"modal.form.type\" name=\"left-size\">\r\n            <n-radio-button :value=\"0\">目录</n-radio-button>\r\n            <n-radio-button :value=\"1\">菜单</n-radio-button>\r\n          </n-radio-group>\r\n        </n-form-item>\r\n        <n-form-item label=\"名称\" path=\"name\">\r\n          <n-input v-model:value=\"modal.form.name\" placeholder=\"输入名称\" />\r\n        </n-form-item>\r\n        <n-form-item label=\"图标\" path=\"icon\">\r\n          <n-input v-model:value=\"modal.form.icon\" placeholder=\"输入菜单图标\" />\r\n        </n-form-item>\r\n        <n-form-item label=\"描述\" path=\"description\">\r\n          <n-input\r\n            v-model:value=\"modal.form.description\"\r\n            type=\"textarea\"\r\n            placeholder=\"请输入描述\"\r\n          />\r\n        </n-form-item>\r\n        <div class=\"flex\">\r\n          <n-form-item label=\"显示\" path=\"state\">\r\n            <n-radio-group v-model:value=\"modal.form.state\" name=\"left-size\">\r\n              <n-radio-button :value=\"0\">否</n-radio-button>\r\n              <n-radio-button :value=\"1\">是</n-radio-button>\r\n            </n-radio-group>\r\n          </n-form-item>\r\n          <n-form-item label=\"排序\" path=\"sort\">\r\n            <n-input-number v-model:value=\"modal.form.sort\" />\r\n          </n-form-item>\r\n        </div>\r\n        <n-form-item label=\"选择级别\" path=\"pid\">\r\n          <n-tree-select\r\n            :virtual-scroll=\"false\"\r\n            :options=\"[{ id: 0, name: '顶级节点' }, ...table.data]\"\r\n            :default-value=\"modal.form.pid\"\r\n            label-field=\"name\"\r\n            key-field=\"id\"\r\n            @update:value=\"\r\n              (e) => {\r\n                modal.form.pid = e;\r\n              }\r\n            \"\r\n          />\r\n        </n-form-item>\r\n      </n-form>\r\n    </page-model>\r\n    <!-- model end -->\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport {\r\n  reactive,\r\n  h,\r\n  onMounted,\r\n  ref,\r\n  withDirectives,\r\n  resolveDirective,\r\n} from \"vue\";\r\nimport { NSpace, NButton, NTag } from \"naive-ui\";\r\nimport { mList, mAdd, mEdit, mDelete } from \"@/api/nav/menus.js\";\r\nonMounted(() => {\r\n  getPageData();\r\n});\r\n// 表格数据\r\nconst table = reactive({\r\n  data: [],\r\n  loading: false,\r\n});\r\n// 弹窗数据\r\nconst modal = reactive({\r\n  title: \"菜单新增\",\r\n  visible: false,\r\n  form: {\r\n    name: \"\",\r\n    icon: \"\",\r\n    description: \"\",\r\n    type: 0,\r\n    state: 1,\r\n    sort: 100,\r\n    pid: 0,\r\n  },\r\n  rules: {\r\n    name: [\r\n      { required: true, message: \"请输入名称！\", trigger: [\"input\", \"blur\"] },\r\n    ],\r\n  },\r\n});\r\n// 获取页面数据\r\nconst getPageData = () => {\r\n  table.loading = true;\r\n  mList().then((res) => {\r\n    table.data = res.data.list;\r\n    table.loading = false;\r\n  });\r\n};\r\n// 表格字段\r\nconst columns = [\r\n  {\r\n    type: \"selection\",\r\n    fixed: \"left\",\r\n  },\r\n  {\r\n    title: \"名称\",\r\n    key: \"name\",\r\n  },\r\n  {\r\n    title: \"描述\",\r\n    key: \"description\",\r\n  },\r\n  {\r\n    title: \"排序\",\r\n    key: \"sort\",\r\n    resizable: true,\r\n  },\r\n  {\r\n    title: \"添加时间\",\r\n    key: \"create_time\",\r\n  },\r\n  {\r\n    title: \"显示\",\r\n    key: \"state\",\r\n    render(row) {\r\n      if (row.state == 0) {\r\n        return h(\r\n          NTag,\r\n          { type: \"error\" },\r\n          {\r\n            default: () => \"否\",\r\n          }\r\n        );\r\n      } else {\r\n        return h(\r\n          NTag,\r\n          { type: \"info\" },\r\n          {\r\n            default: () => \"是\",\r\n          }\r\n        );\r\n      }\r\n    },\r\n  },\r\n  {\r\n    title: \"操作\",\r\n    key: \"actions\",\r\n    width: \"150\",\r\n    fixed: \"right\",\r\n    render(row) {\r\n      const permission = resolveDirective(\"permission\");\r\n      return h(\r\n        NSpace,\r\n        {},\r\n        {\r\n          default: () => [\r\n            withDirectives(\r\n              h(\r\n                NButton,\r\n                { size: \"small\",type:\"primary\", onClick: () => editRow(row) },\r\n                { default: () => \"编辑\" }\r\n              ),\r\n              [[permission, { action: \"nmenu:edit\" }]]\r\n            ),\r\n            withDirectives(\r\n              h(\r\n                NButton,\r\n                { size: \"small\", type: \"error\", onClick: () => deleteRow(row) },\r\n                { default: () => \"删除\" }\r\n              ),\r\n              [[permission, { action: \"nmenu:delete\" }]]\r\n            ),\r\n          ],\r\n        }\r\n      );\r\n    },\r\n  },\r\n];\r\nconst addFormData = () => {\r\n  modal.title = \"菜单新增\";\r\n  modal.visible = true;\r\n  modal.form = {\r\n    name: \"\",\r\n    icon: \"\",\r\n    description: \"\",\r\n    type: 0,\r\n    state: 1,\r\n    sort: 100,\r\n    pid: 0,\r\n  };\r\n};\r\nconst formValidate = (o, callback) => {\r\n  o.value?.validate((errors) => {\r\n    if (!errors) {\r\n      console.log(\"suc\");\r\n      callback && callback();\r\n    } else {\r\n      console.log(errors);\r\n    }\r\n  });\r\n};\r\n// 新增保存\r\nconst saveFormData = () => {\r\n  const formRefs = ref(null);\r\n  formValidate(formRefs, addEditData());\r\n};\r\n// 新增编辑\r\nconst addEditData = async () => {\r\n  const res = modal.form.id ? await mEdit(modal.form) : await mAdd(modal.form);\r\n  if (res.code === 200) (modal.visible = false), getPageData();\r\n  $message.success(res.message);\r\n};\r\n\r\n// 编辑行\r\nconst editRow = (row) => {\r\n  modal.title = \"菜单修改\";\r\n  modal.visible = true;\r\n  modal.form = Object.assign({}, row);\r\n};\r\nconst deleteId = (row) => {\r\n  mDelete({ id: row.id }).then((res) => {\r\n    $message.success(res.message);\r\n    getPageData();\r\n  });\r\n};\r\n// 删除行\r\nconst deleteRow = (row) => {\r\n  $dialog.confirm({\r\n    title: \"删除警告\",\r\n    content: \"你确定要删除此菜单吗？\",\r\n    confirm() {\r\n      deleteId(row);\r\n    },\r\n    cancel() {\r\n      $message.success(\"取消删除！\");\r\n    },\r\n  });\r\n};\r\n</script>"],"names":["onMounted","getPageData","table","reactive","modal","mList","res","columns","row","h","NTag","permission","resolveDirective","NSpace","withDirectives","NButton","editRow","deleteRow","addFormData","formValidate","callback","_a","errors","saveFormData","formRefs","ref","addEditData","__async","mEdit","mAdd","deleteId","mDelete"],"mappings":"giBA4FAA,EAAU,IAAM,CACdC,GACF,CAAC,EAED,MAAMC,EAAQC,EAAS,CACrB,KAAM,CAAE,EACR,QAAS,EACX,CAAC,EAEKC,EAAQD,EAAS,CACrB,MAAO,OACP,QAAS,GACT,KAAM,CACJ,KAAM,GACN,KAAM,GACN,YAAa,GACb,KAAM,EACN,MAAO,EACP,KAAM,IACN,IAAK,CACN,EACD,MAAO,CACL,KAAM,CACJ,CAAE,SAAU,GAAM,QAAS,SAAU,QAAS,CAAC,QAAS,MAAM,CAAG,CAClE,CACF,CACH,CAAC,EAEKF,EAAc,IAAM,CACxBC,EAAM,QAAU,GAChBG,EAAO,EAAC,KAAMC,GAAQ,CACpBJ,EAAM,KAAOI,EAAI,KAAK,KACtBJ,EAAM,QAAU,EACpB,CAAG,CACH,EAEMK,EAAU,CACd,CACE,KAAM,YACN,MAAO,MACR,EACD,CACE,MAAO,KACP,IAAK,MACN,EACD,CACE,MAAO,KACP,IAAK,aACN,EACD,CACE,MAAO,KACP,IAAK,OACL,UAAW,EACZ,EACD,CACE,MAAO,OACP,IAAK,aACN,EACD,CACE,MAAO,KACP,IAAK,QACL,OAAOC,EAAK,CACV,OAAIA,EAAI,OAAS,EACRC,EACLC,EACA,CAAE,KAAM,OAAS,EACjB,CACE,QAAS,IAAM,GAChB,CACX,EAEeD,EACLC,EACA,CAAE,KAAM,MAAQ,EAChB,CACE,QAAS,IAAM,GAChB,CACX,CAEK,CACF,EACD,CACE,MAAO,KACP,IAAK,UACL,MAAO,MACP,MAAO,QACP,OAAOF,EAAK,CACV,MAAMG,EAAaC,EAAiB,YAAY,EAChD,OAAOH,EACLI,EACA,CAAE,EACF,CACE,QAAS,IAAM,CACbC,EACEL,EACEM,EACA,CAAE,KAAM,QAAQ,KAAK,UAAW,QAAS,IAAMC,EAAQR,CAAG,CAAG,EAC7D,CAAE,QAAS,IAAM,IAAM,CACxB,EACD,CAAC,CAACG,EAAY,CAAE,OAAQ,YAAc,CAAA,CAAC,CACxC,EACDG,EACEL,EACEM,EACA,CAAE,KAAM,QAAS,KAAM,QAAS,QAAS,IAAME,EAAUT,CAAG,CAAG,EAC/D,CAAE,QAAS,IAAM,IAAM,CACxB,EACD,CAAC,CAACG,EAAY,CAAE,OAAQ,cAAgB,CAAA,CAAC,CAC1C,CACF,CACF,CACT,CACK,CACF,CACH,EACMO,EAAc,IAAM,CACxBd,EAAM,MAAQ,OACdA,EAAM,QAAU,GAChBA,EAAM,KAAO,CACX,KAAM,GACN,KAAM,GACN,YAAa,GACb,KAAM,EACN,MAAO,EACP,KAAM,IACN,IAAK,CACT,CACA,EACMe,EAAe,CAAC,EAAGC,IAAa,QACpCC,EAAA,EAAE,QAAF,MAAAA,EAAS,SAAUC,GAAW,CACvBA,EAIH,QAAQ,IAAIA,CAAM,GAHlB,QAAQ,IAAI,KAAK,EACjBF,GAAYA,EAAQ,EAI1B,EACA,EAEMG,EAAe,IAAM,CACzB,MAAMC,EAAWC,EAAI,IAAI,EACzBN,EAAaK,EAAUE,EAAW,CAAE,CACtC,EAEMA,EAAc,IAAYC,EAAA,sBAC9B,MAAMrB,EAAMF,EAAM,KAAK,GAAK,MAAMwB,EAAMxB,EAAM,IAAI,EAAI,MAAMyB,EAAKzB,EAAM,IAAI,EACvEE,EAAI,OAAS,MAAMF,EAAM,QAAU,GAAQH,KAC/C,SAAS,QAAQK,EAAI,OAAO,CAC9B,GAGMU,EAAWR,GAAQ,CACvBJ,EAAM,MAAQ,OACdA,EAAM,QAAU,GAChBA,EAAM,KAAO,OAAO,OAAO,CAAE,EAAEI,CAAG,CACpC,EACMsB,EAAYtB,GAAQ,CACxBuB,EAAQ,CAAE,GAAIvB,EAAI,EAAE,CAAE,EAAE,KAAMF,GAAQ,CACpC,SAAS,QAAQA,EAAI,OAAO,EAC5BL,GACJ,CAAG,CACH,EAEMgB,EAAaT,GAAQ,CACzB,QAAQ,QAAQ,CACd,MAAO,OACP,QAAS,cACT,SAAU,CACRsB,EAAStB,CAAG,CACb,EACD,QAAS,CACP,SAAS,QAAQ,OAAO,CACzB,CACL,CAAG,CACH"}
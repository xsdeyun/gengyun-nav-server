{"version":3,"file":"d51cd1b9.js","sources":["../../src/views/system/sysMenus.vue"],"sourcesContent":["<template>\r\n  <div class=\"page-contanier\">\r\n    <div ref=\"pageHeader\" class=\"page-header\">\r\n      <!-- <page-search></page-search> -->\r\n      <page-describe\r\n        title=\"系统菜单\"\r\n        desc=\"用于创建导航栏菜单和动态路由\"\r\n      ></page-describe>\r\n    </div>\r\n    <div class=\"page-content\">\r\n      <!-- table strat -->\r\n      <page-table\r\n        :data=\"table.data\"\r\n        :columns=\"columns\"\r\n        :loading=\"table.loading\"\r\n        @on-add=\"addFormData\"\r\n        @on-refresh=\"getPageData()\"\r\n        :permission=\"{ action: 'menus:add' }\"\r\n      ></page-table>\r\n      <!-- table end -->\r\n    </div>\r\n    <!-- model strat -->\r\n    <page-model\r\n      v-model:visible=\"modal.visible\"\r\n      :title=\"modal.title\"\r\n      @on-save=\"saveFormData\"\r\n    >\r\n      <n-form\r\n        ref=\"formRefs\"\r\n        label-placement=\"left\"\r\n        :label-width=\"80\"\r\n        :model=\"modal.form\"\r\n        :rules=\"modal.rules\"\r\n        :show-require-mark=\"true\"\r\n      >\r\n        <n-form-item label=\"类型\" path=\"type\">\r\n          <n-radio-group v-model:value=\"modal.form.type\" name=\"left-size\">\r\n            <n-radio-button :value=\"0\">目录</n-radio-button>\r\n            <n-radio-button :value=\"1\">菜单</n-radio-button>\r\n            <n-radio-button :value=\"2\">按钮</n-radio-button>\r\n          </n-radio-group>\r\n        </n-form-item>\r\n        <template v-if=\"modal.form.type != 2\">\r\n          <n-form-item label=\"名称\" path=\"name\">\r\n            <n-input\r\n              v-model:value=\"modal.form.name\"\r\n              placeholder=\"输入名称:系统管理\"\r\n            />\r\n          </n-form-item>\r\n          <n-form-item label=\"图标\" path=\"icon\">\r\n            <n-input\r\n              v-model:value=\"modal.form.icon\"\r\n              placeholder=\"输入菜单图标:System\"\r\n            />\r\n          </n-form-item>\r\n          <div class=\"flex\">\r\n            <n-form-item label=\"外链\" path=\"iframe\">\r\n              <n-radio-group v-model:value=\"modal.form.iframe\" name=\"left-size\">\r\n                <n-radio-button :value=\"0\">否</n-radio-button>\r\n                <n-radio-button :value=\"1\">是</n-radio-button>\r\n              </n-radio-group>\r\n            </n-form-item>\r\n            <n-form-item label=\"隐藏\" path=\"icon\">\r\n              <n-radio-group v-model:value=\"modal.form.hidden\" name=\"left-size\">\r\n                <n-radio-button :value=\"0\">否</n-radio-button>\r\n                <n-radio-button :value=\"1\">是</n-radio-button>\r\n              </n-radio-group>\r\n            </n-form-item>\r\n          </div>\r\n          <n-form-item label=\"路由\" path=\"path\">\r\n            <n-input\r\n              v-model:value=\"modal.form.path\"\r\n              placeholder=\"输入路由地址:/system\"\r\n            />\r\n          </n-form-item>\r\n        </template>\r\n        <div class=\"flex justify-between\" v-if=\"modal.form.type == 1\">\r\n          <n-form-item label=\"组件名称\" path=\"component_name\">\r\n            <n-input\r\n              v-model:value=\"modal.form.component_name\"\r\n              placeholder=\"输入组件名称:system\"\r\n            />\r\n          </n-form-item>\r\n          <n-form-item label=\"组件路径\" path=\"component\">\r\n            <n-input\r\n              v-model:value=\"modal.form.component\"\r\n              placeholder=\"输入组件路径:system/sysUser\"\r\n            />\r\n          </n-form-item>\r\n        </div>\r\n        <div class=\"flex justify-between\" v-if=\"modal.form.type == 2\">\r\n          <n-form-item label=\"按钮名称\" path=\"name\">\r\n            <n-input\r\n              v-model:value=\"modal.form.name\"\r\n              placeholder=\"输入按钮名称:列表\"\r\n            />\r\n          </n-form-item>\r\n          <n-form-item label=\"权限标识\" path=\"permission\">\r\n            <n-input\r\n              v-model:value=\"modal.form.permission\"\r\n              placeholder=\"输入权限标识:system:list\"\r\n            />\r\n          </n-form-item>\r\n        </div>\r\n        <div class=\"flex\">\r\n          <n-form-item label=\"排序\" path=\"sort\">\r\n            <n-input-number v-model:value=\"modal.form.sort\" />\r\n          </n-form-item>\r\n          <n-form-item\r\n            label=\"结构\"\r\n            path=\"layout\"\r\n            style=\"width: 50%\"\r\n            v-if=\"modal.form.type != 2\"\r\n          >\r\n            <n-select\r\n              :consistent-menu-width=\"false\"\r\n              v-model:value=\"modal.form.layout\"\r\n              :options=\"[\r\n                { label: '默认', value: 'defautl' },\r\n                { label: '新打开', value: 'target' },\r\n              ]\"\r\n            />\r\n          </n-form-item>\r\n        </div>\r\n        <n-form-item label=\"选择级别\" path=\"pid\">\r\n          <n-tree-select\r\n            :virtual-scroll=\"false\"\r\n            :options=\"[{ id: 0, name: '顶级节点' }, ...table.data]\"\r\n            :default-value=\"modal.form.pid\"\r\n            label-field=\"name\"\r\n            key-field=\"id\"\r\n            @update:value=\"\r\n              (e) => {\r\n                modal.form.pid = e;\r\n              }\r\n            \"\r\n          />\r\n        </n-form-item>\r\n      </n-form>\r\n    </page-model>\r\n    <!-- model end -->\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport {\r\n  reactive,\r\n  h,\r\n  onMounted,\r\n  ref,\r\n  withDirectives,\r\n  resolveDirective\r\n} from \"vue\";\r\nimport { NSpace, NButton, NTag } from \"naive-ui\";\r\nimport { mList, mAdd, mEdit, mDelete } from \"@/api/system/menus.js\";\r\nonMounted(() => {\r\n  getPageData();\r\n});\r\n// 表格数据\r\nconst table = reactive({\r\n  data: [],\r\n  loading: false,\r\n});\r\n// 弹窗数据\r\nconst modal = reactive({\r\n  title: \"菜单新增\",\r\n  visible: false,\r\n  form: {\r\n    name: \"\",\r\n    icon: \"\",\r\n    type: 0,\r\n    ifarme: 0,\r\n    hidden: 0,\r\n    path: \"\",\r\n    component_name: \"\",\r\n    component: \"\",\r\n    sort: 100,\r\n    layout: \"defautl\",\r\n    pid: 0,\r\n    permission: \"\",\r\n  },\r\n  rules: {\r\n    name: [\r\n      { required: true, message: \"请输入名称！\", trigger: [\"input\", \"blur\"] },\r\n    ],\r\n    path: [\r\n      { required: true, message: \"请输入路由！\", trigger: [\"input\", \"blur\"] },\r\n    ],\r\n    component_name: [\r\n      {\r\n        required: true,\r\n        message: \"请输入组件名称！\",\r\n        trigger: [\"input\", \"blur\"],\r\n      },\r\n    ],\r\n    permission: [\r\n      {\r\n        required: true,\r\n        message: \"请输入权限标识！\",\r\n        trigger: [\"input\", \"blur\"],\r\n      },\r\n    ],\r\n  },\r\n});\r\n// 获取页面数据\r\nconst getPageData = () => {\r\n  table.loading = true;\r\n  mList().then((res) => {\r\n    table.data = res.data.list;\r\n    table.loading = false;\r\n  });\r\n};\r\n// 表格字段\r\nconst columns = [\r\n  {\r\n    type: \"selection\",\r\n    fixed: \"left\",\r\n  },\r\n  {\r\n    title: \"名称\",\r\n    key: \"name\",\r\n    resizable: true,\r\n    width: 180\r\n  },\r\n  {\r\n    title: \"组件名称\",\r\n    key: \"component_name\",\r\n  },\r\n  {\r\n    title: \"组件\",\r\n    key: \"component\",\r\n  },\r\n  {\r\n    title: \"路由\",\r\n    key: \"path\",\r\n  },\r\n  {\r\n    title: \"权限\",\r\n    key: \"permission\",\r\n  },\r\n  {\r\n    title: \"外链\",\r\n    key: \"iframe\",\r\n    render(row) {\r\n      if (row.iframe == 0) {\r\n        return h(\r\n          NTag,\r\n          { type: \"info\" },\r\n          {\r\n            default: () => \"当前窗口\",\r\n          }\r\n        );\r\n      } else {\r\n        return h(\r\n          NTag,\r\n          { type: \"info\" },\r\n          {\r\n            default: () => \"外链\",\r\n          }\r\n        );\r\n      }\r\n    },\r\n  },\r\n  {\r\n    title: \"隐藏\",\r\n    key: \"hidden\",\r\n    render(row) {\r\n      if (row.hidden == 0) {\r\n        return h(\r\n          NTag,\r\n          { type: \"info\" },\r\n          {\r\n            default: () => \"显示\",\r\n          }\r\n        );\r\n      } else {\r\n        return h(\r\n          NTag,\r\n          { type: \"info\" },\r\n          {\r\n            default: () => \"隐藏\",\r\n          }\r\n        );\r\n      }\r\n    },\r\n  },\r\n  {\r\n    title: \"排序\",\r\n    key: \"sort\",\r\n    resizable: true,\r\n  },\r\n  {\r\n    title: \"操作\",\r\n    key: \"actions\",\r\n    width: \"150\",\r\n    fixed: \"right\",\r\n    render(row) {\r\n      const permission = resolveDirective(\"permission\");\r\n      return h(\r\n        NSpace,\r\n        {},\r\n        {\r\n          default: () => [\r\n            withDirectives(\r\n              h(\r\n                NButton,\r\n                { size: \"small\",type:\"primary\", onClick: () => editRow(row) },\r\n                { default: () => \"编辑\" }\r\n              ),\r\n              [[permission, { action: \"menus:edit\" }]]\r\n            ),\r\n            withDirectives(\r\n              h(\r\n                NButton,\r\n                { size: \"small\", type: \"error\", onClick: () => deleteRow(row) },\r\n                { default: () => \"删除\" }\r\n              ),\r\n              [[permission, { action: \"menus:delete\" }]]\r\n            ),\r\n          ],\r\n        }\r\n      );\r\n    },\r\n  },\r\n];\r\nconst addFormData = () => {\r\n  modal.title = \"菜单新增\";\r\n  modal.visible = true;\r\n  modal.form = {\r\n    name: \"\",\r\n    icon: \"\",\r\n    type: 0,\r\n    iframe: 0,\r\n    hidden: 0,\r\n    path: \"\",\r\n    component_name: \"\",\r\n    component: \"\",\r\n    sort: 100,\r\n    layout: \"defautl\",\r\n    pid: 0,\r\n    permission: \"\",\r\n  };\r\n};\r\nconst formValidate = (o, callback) => {\r\n  o.value?.validate((errors) => {\r\n    if (!errors) {\r\n      console.log(\"suc\");\r\n      callback && callback();\r\n    } else {\r\n      console.log(errors);\r\n    }\r\n  });\r\n};\r\n// 新增保存\r\nconst saveFormData = () => {\r\n  const formRefs = ref(null);\r\n  formValidate(formRefs, addEditData());\r\n};\r\n// 新增编辑\r\nconst addEditData = async () => {\r\n  const res = modal.form.id ? await mEdit(modal.form) : await mAdd(modal.form);\r\n  if (res.code === 200) (modal.visible = false), getPageData();\r\n  $message.success(res.message);\r\n};\r\n\r\n// 编辑行\r\nconst editRow = (row) => {\r\n  modal.title = \"菜单修改\";\r\n  modal.visible = true;\r\n  modal.form = Object.assign({}, row);\r\n};\r\nconst deleteId = (row) => {\r\n  mDelete({ id: row.id }).then((res) => {\r\n    $message.success(res.message);\r\n    getPageData();\r\n  });\r\n};\r\n// 删除行\r\nconst deleteRow = (row) => {\r\n  $dialog.confirm({\r\n    title: \"删除警告\",\r\n    content: \"你确定要删除此菜单吗？\",\r\n    confirm() {\r\n      deleteId(row);\r\n    },\r\n    cancel() {\r\n      $message.success(\"取消删除！\");\r\n    },\r\n  });\r\n};\r\n</script>"],"names":["onMounted","getPageData","table","reactive","modal","mList","res","columns","row","h","NTag","permission","resolveDirective","NSpace","withDirectives","NButton","editRow","deleteRow","addFormData","formValidate","o","callback","_a","errors","saveFormData","formRefs","ref","addEditData","__async","mEdit","mAdd","deleteId","mDelete"],"mappings":"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"}
{"version":3,"file":"cad56c85.js","sources":["../../src/views/system/sysUser.vue"],"sourcesContent":["<template>\r\n  <div class=\"page-contanier\">\r\n    <div ref=\"pageHeader\" class=\"page-header\">\r\n      <page-search\r\n        v-model:value=\"search.value\"\r\n        @on-search=\"getPageData()\"\r\n        @on-reset=\"getPageData()\"\r\n      ></page-search>\r\n    </div>\r\n    <div class=\"page-content\">\r\n      <!-- table strat -->\r\n      <page-table\r\n        :data=\"table.data\"\r\n        :columns=\"table.columns\"\r\n        :loading=\"table.loading\"\r\n        :permission=\"{ action: 'user:add' }\"\r\n        @on-add=\"addFormData\"\r\n        @on-refresh=\"getPageData()\"\r\n        :pagination=\"true\"\r\n        :pageProps=\"pageProps\"\r\n        @on-updatePage=\"UpdatePageChange\"\r\n      >\r\n      </page-table>\r\n      <!-- table end -->\r\n    </div>\r\n    <!-- model strat -->\r\n    <page-model\r\n      v-model:visible=\"modal.visible\"\r\n      :title=\"modal.title\"\r\n      @on-save=\"saveFormData\"\r\n    >\r\n      <n-form\r\n        ref=\"formRefs\"\r\n        label-placement=\"left\"\r\n        :label-width=\"80\"\r\n        :model=\"modal.form\"\r\n        :rules=\"modal.rules\"\r\n        :show-require-mark=\"true\"\r\n      >\r\n        <n-form-item label=\"用户名\" path=\"username\">\r\n          <n-input\r\n            v-model:value=\"modal.form.username\"\r\n            placeholder=\"请输入用户名...\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"昵称\" path=\"nick_name\">\r\n          <n-input\r\n            v-model:value=\"modal.form.nick_name\"\r\n            placeholder=\"请输入昵称...\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"邮箱\" path=\"email\">\r\n          <n-input\r\n            v-model:value=\"modal.form.email\"\r\n            placeholder=\"请输入邮箱...\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"状态\" path=\"state\">\r\n          <n-radio-group v-model:value=\"modal.form.state\" name=\"userstate\">\r\n            <n-space>\r\n              <n-radio :value=\"1\"> 启用 </n-radio>\r\n              <n-radio :value=\"0\"> 禁用 </n-radio>\r\n            </n-space>\r\n          </n-radio-group>\r\n        </n-form-item>\r\n        <n-form-item label=\"选择角色\" path=\"roles\">\r\n          <n-select\r\n            v-model:value=\"modal.form.roles\"\r\n            :options=\"rolesData\"\r\n            label-field=\"name\"\r\n            value-field=\"id\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"备注\" path=\"notes\">\r\n          <n-input\r\n            v-model:value=\"modal.form.notes\"\r\n            type=\"textarea\"\r\n            placeholder=\"---\"\r\n          />\r\n        </n-form-item>\r\n      </n-form>\r\n    </page-model>\r\n    <!-- model end -->\r\n    <updatePass ref=\"passWord\"></updatePass>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport {\r\n  reactive,\r\n  onMounted,\r\n  h,\r\n  ref,\r\n  withDirectives,\r\n  resolveDirective,\r\n} from \"vue\";\r\nimport { uAdd, uEdit, uDelete, uList, uState } from \"@/api/system/user.js\";\r\nimport { rList } from \"@/api/system/role.js\";\r\nimport { NSpace, NButton, NSwitch } from \"naive-ui\";\r\nimport { validateEmail } from \"@/utils\";\r\nimport updatePass from \"@/components/updatePass/index.vue\";\r\n// search\r\nconst search = reactive({\r\n  value: \"\",\r\n});\r\nconst rolesData = ref([]);\r\n// page\r\nconst pageProps = reactive({\r\n  page: 1,\r\n  pageSize: 10,\r\n  total: 0,\r\n});\r\n// table data\r\nconst table = reactive({\r\n  data: [],\r\n  loading: false,\r\n  columns: [\r\n    {\r\n      type: \"selection\",\r\n      fixed: \"left\",\r\n    },\r\n    {\r\n      title: \"用户名\",\r\n      key: \"username\",\r\n    },\r\n    {\r\n      title: \"昵称\",\r\n      key: \"nick_name\",\r\n    },\r\n    {\r\n      title: \"邮箱\",\r\n      key: \"email\",\r\n    },\r\n    {\r\n      title: \"备注\",\r\n      key: \"notes\",\r\n    },\r\n    {\r\n      title: \"状态\",\r\n      key: \"status\",\r\n      render(row) {\r\n        return h(NSwitch, {\r\n          value: row.state,\r\n          checkedValue: 1,\r\n          uncheckedValue: 0,\r\n          \"on-update:value\": (val) => updateState(row, val),\r\n        });\r\n      },\r\n    },\r\n    {\r\n      title: \"创建日期\",\r\n      key: \"create_time\",\r\n    },\r\n    {\r\n      title: \"操作\",\r\n      key: \"actions\",\r\n      width: 200,\r\n      fixed: \"right\",\r\n      render(row) {\r\n        const permission = resolveDirective(\"permission\");\r\n        return h(\r\n          NSpace,\r\n          {},\r\n          {\r\n            default: () => [\r\n              withDirectives(\r\n                h(\r\n                  NButton,\r\n                  {\r\n                    size: \"small\",\r\n                    onClick: () => updatePassword(row),\r\n                  },\r\n                  { default: () => \"密码\" }\r\n                ),\r\n                [[permission, { action: \"user:password\" }]]\r\n              ),\r\n              withDirectives(\r\n                h(\r\n                  NButton,\r\n                  { size: \"small\",type:\"primary\", onClick: () => editRow(row) },\r\n                  { default: () => \"编辑\" }\r\n                ),\r\n                [[permission, { action: \"user:edit\" }]]\r\n              ),\r\n              withDirectives(\r\n                h(\r\n                  NButton,\r\n                  {\r\n                    size: \"small\",\r\n                    type: \"error\",\r\n                    onClick: () => deleteRow(row),\r\n                  },\r\n                  { default: () => \"删除\" }\r\n                ),\r\n                [[permission, { action: \"user:delete\" }]]\r\n              ),\r\n            ],\r\n          }\r\n        );\r\n      },\r\n    },\r\n  ],\r\n});\r\n// 弹窗数据\r\nconst modal = reactive({\r\n  title: \"用户新增\",\r\n  visible: false,\r\n  form: {\r\n    username: \"\",\r\n    nick_name: \"\",\r\n    email: \"\",\r\n    state: 1,\r\n    notes: \"\",\r\n    roles: 4,\r\n  },\r\n  rules: {\r\n    username: [\r\n      { required: true, message: \"请输入用户名！\", trigger: [\"input\", \"blur\"] },\r\n    ],\r\n    nickName: [\r\n      { required: true, message: \"请输入用昵称！\", trigger: [\"input\", \"blur\"] },\r\n    ],\r\n    email: [\r\n      {\r\n        required: true,\r\n        message: \"邮箱格式不正确！\",\r\n        trigger: [\"input\", \"blur\"],\r\n        validator: (rule, value) => {\r\n          return validateEmail(value);\r\n        },\r\n      },\r\n    ],\r\n  },\r\n});\r\n// initialization\r\nonMounted(() => {\r\n  getPageData();\r\n  getRolesData();\r\n});\r\n// get data\r\nconst getPageData = () => {\r\n  table.loading = true;\r\n  const params = {\r\n    keyword: search.value,\r\n    page: pageProps.page,\r\n    pageSize: pageProps.pageSize,\r\n  };\r\n  uList(params).then((res) => {\r\n    table.data = res.data.list.data;\r\n    pageProps.total = res.data.list.total;\r\n    table.loading = false;\r\n  });\r\n};\r\nconst getRolesData = () => {\r\n  const params = {\r\n    page: 1,\r\n    pageSize: 9999,\r\n  };\r\n  rList(params).then((res) => {\r\n    rolesData.value = res.data.list.data;\r\n  });\r\n};\r\n// page update data\r\nconst UpdatePageChange = (a) => {\r\n  pageProps.page = a.page;\r\n  pageProps.pageSize = a.pageSize;\r\n  getPageData();\r\n};\r\n// 密码修改\r\nconst passWord = ref(null);\r\nconst updatePassword = (row) => {\r\n  passWord.value?.passShow(row.id);\r\n};\r\n// data edit\r\nconst editRow = (row) => {\r\n  modal.title = \"用户编辑\";\r\n  modal.visible = true;\r\n  modal.form = Object.assign({}, row);\r\n};\r\n// delete\r\nconst deleteId = (row) => {\r\n  uDelete({ id: row.id }).then((res) => {\r\n    $message.success(res.message);\r\n    getPageData();\r\n  });\r\n};\r\n// data delete\r\nconst deleteRow = (row) => {\r\n  $dialog.confirm({\r\n    title: \"删除警告\",\r\n    content: \"你确定要删除此用户吗？\",\r\n    confirm() {\r\n      deleteId(row);\r\n    },\r\n    cancel() {\r\n      $message.success(\"取消删除！\");\r\n    },\r\n  });\r\n};\r\n// updaate state\r\nconst updateState = (row, val) => {\r\n  uState({ id: row.id, state: val }).then((res) => {\r\n    $message.success(res.message);\r\n    getPageData();\r\n  });\r\n};\r\n// validate rules\r\nconst formValidate = (o, callback) => {\r\n  o.value?.validate((errors) => {\r\n    if (!errors) {\r\n      console.log(\"suc\");\r\n      callback && callback();\r\n    } else {\r\n      console.log(errors);\r\n    }\r\n  });\r\n};\r\n// save form\r\nconst saveFormData = () => {\r\n  const formRefs = ref(null);\r\n  formValidate(formRefs, addEditData());\r\n};\r\nconst addEditData = async () => {\r\n  const res = modal.form.id ? await uEdit(modal.form) : await uAdd(modal.form);\r\n  if (res.code === 200) (modal.visible = false), getPageData();\r\n  $message.success(res.message);\r\n};\r\n// add form\r\nconst addFormData = () => {\r\n  modal.title = \"用户新增\";\r\n  modal.visible = true;\r\n  modal.form = {\r\n    username: \"\",\r\n    nick_name: \"\",\r\n    email: \"\",\r\n    state: 1,\r\n    notes: \"\",\r\n    roles: 4,\r\n  };\r\n};\r\n</script>"],"names":["search","reactive","rolesData","ref","pageProps","table","row","h","NSwitch","val","updateState","permission","resolveDirective","NSpace","withDirectives","NButton","updatePassword","editRow","deleteRow","modal","rule","value","validateEmail","onMounted","getPageData","getRolesData","params","uList","res","rList","UpdatePageChange","passWord","_a","deleteId","uDelete","uState","formValidate","o","callback","errors","saveFormData","formRefs","addEditData","__async","uEdit","uAdd","addFormData"],"mappings":"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"}
{"version":3,"file":"9413906d.js","sources":["../../src/api/nav/links.js","../../src/views/navman/navlinks.vue"],"sourcesContent":["import { request } from '@/utils'\r\n\r\nexport function lFavicon(params) {\r\n    return request({\r\n        url: '/admin/nav.links/Favicon',\r\n        method: 'get',\r\n        params: params\r\n    })\r\n}\r\nexport function lList(params) {\r\n    return request({\r\n        url: '/admin/nav.links/list',\r\n        method: 'get',\r\n        params: params\r\n    })\r\n}\r\nexport function lAdd(data) {\r\n    return request({\r\n        url: '/admin/nav.links/add',\r\n        method: 'post',\r\n        data: data\r\n    })\r\n}\r\nexport function lEdit(data) {\r\n    return request({\r\n        url: '/admin/nav.links/edit',\r\n        method: 'PUT',\r\n        data: data\r\n    })\r\n}\r\nexport function lDelete(params) {\r\n    return request({\r\n        url: '/admin/nav.links/del',\r\n        method: 'delete',\r\n        params: params\r\n    })\r\n}","<template>\r\n  <div class=\"page-contanier\">\r\n    <div ref=\"pageHeader\" class=\"page-header\">\r\n      <page-search\r\n        v-model:value=\"search.value\"\r\n        @on-search=\"handleSearch()\"\r\n        @on-reset=\"resetSearch\"\r\n      >\r\n        <n-tree-select\r\n          class=\"w-xs mr-5\"\r\n          v-model:value=\"search.menu\"\r\n          placeholder=\"选择菜单\"\r\n          :options=\"menus\"\r\n          label-field=\"name\"\r\n          key-field=\"id\"\r\n        />\r\n      </page-search>\r\n    </div>\r\n    <div class=\"page-content\">\r\n      <!-- table strat -->\r\n      <page-table\r\n        :data=\"table.data\"\r\n        :columns=\"columns\"\r\n        :loading=\"table.loading\"\r\n        @on-add=\"addFormData\"\r\n        @on-refresh=\"getPageData()\"\r\n        :pagination=\"true\"\r\n        :pageProps=\"pageProps\"\r\n        @on-updatePage=\"UpdatePageChange\"\r\n        :permission=\"{ action: 'nlinks:add' }\"\r\n      ></page-table>\r\n      <!-- table end -->\r\n    </div>\r\n    <!-- model strat -->\r\n    <page-model\r\n      v-model:visible=\"modal.visible\"\r\n      :title=\"modal.title\"\r\n      @on-save=\"saveFormData\"\r\n    >\r\n      <n-form\r\n        ref=\"formRefs\"\r\n        label-placement=\"left\"\r\n        :label-width=\"80\"\r\n        :model=\"modal.form\"\r\n        :rules=\"modal.rules\"\r\n        :show-require-mark=\"true\"\r\n      >\r\n        <n-form-item label=\"名称\" path=\"name\">\r\n          <n-input v-model:value=\"modal.form.name\" placeholder=\"输入名称\" />\r\n        </n-form-item>\r\n        <n-form-item label=\"图标\" path=\"icon\">\r\n          <n-input v-model:value=\"modal.form.icon\" placeholder=\"输入链接图标\" />\r\n        </n-form-item>\r\n        <n-form-item label=\"描述\" path=\"description\">\r\n          <n-input\r\n            v-model:value=\"modal.form.description\"\r\n            type=\"textarea\"\r\n            placeholder=\"请输入描述\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"链接\" path=\"link\">\r\n          <n-input v-model:value=\"modal.form.link\" placeholder=\"输入链接地址\" />\r\n          <n-icon\r\n            size=\"30\"\r\n            class=\"cursor-pointer m-l-5\"\r\n            color=\"#2d8cf0\"\r\n            @click=\"getFavicoData\"\r\n          >\r\n            <LogoIonic />\r\n          </n-icon>\r\n        </n-form-item>\r\n        <div class=\"flex\">\r\n          <n-form-item label=\"显示\" path=\"state\">\r\n            <n-radio-group v-model:value=\"modal.form.state\" name=\"left-size\">\r\n              <n-radio-button :value=\"0\">否</n-radio-button>\r\n              <n-radio-button :value=\"1\">是</n-radio-button>\r\n            </n-radio-group>\r\n          </n-form-item>\r\n          <n-form-item label=\"排序\" path=\"sort\">\r\n            <n-input-number v-model:value=\"modal.form.sort\" />\r\n          </n-form-item>\r\n        </div>\r\n        <div class=\"flex\">\r\n          <n-form-item label=\"浏览量\" path=\"views\">\r\n            <n-input-number v-model:value=\"modal.form.views\" />\r\n          </n-form-item>\r\n          <n-form-item label=\"收藏量\" path=\"likes\">\r\n            <n-input-number v-model:value=\"modal.form.likes\" />\r\n          </n-form-item>\r\n        </div>\r\n        <n-form-item label=\"选择菜单\" path=\"menu_id\">\r\n          <n-tree-select\r\n            multiple\r\n            :virtual-scroll=\"false\"\r\n            :options=\"menus\"\r\n            :default-value=\"modal.form.menu_id\"\r\n            label-field=\"name\"\r\n            key-field=\"id\"\r\n            @update:value=\"\r\n              (e) => {\r\n                modal.form.menu_id = e;\r\n              }\r\n            \"\r\n          />\r\n        </n-form-item>\r\n      </n-form>\r\n    </page-model>\r\n    <!-- model end -->\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport {\r\n  reactive,\r\n  h,\r\n  onMounted,\r\n  ref,\r\n  withDirectives,\r\n  resolveDirective,\r\n} from \"vue\";\r\nimport { NSpace, NButton, NTag, NImage } from \"naive-ui\";\r\nimport { lList, lAdd, lEdit, lDelete, lFavicon } from \"@/api/nav/links.js\";\r\nimport { mList } from \"@/api/nav/menus.js\";\r\nonMounted(() => {\r\n  getPageData();\r\n  getMenusData();\r\n});\r\nconst menus = ref([]);\r\n// search\r\nconst search = reactive({\r\n  value: \"\",\r\n  menu: \"\",\r\n});\r\n// page\r\nconst pageProps = reactive({\r\n  page: 1,\r\n  pageSize: 10,\r\n  total: 0,\r\n});\r\n// 表格数据\r\nconst table = reactive({\r\n  data: [],\r\n  loading: false,\r\n});\r\n// 弹窗数据\r\nconst modal = reactive({\r\n  title: \"添加链接\",\r\n  visible: false,\r\n  form: {\r\n    name: \"\",\r\n    icon: \"\",\r\n    description: \"\",\r\n    link: \"\",\r\n    state: 1,\r\n    sort: 100,\r\n    views: 1000,\r\n    likes: 1000,\r\n    menu_id: 1,\r\n  },\r\n  rules: {\r\n    name: [\r\n      { required: true, message: \"请输入名称！\", trigger: [\"input\", \"blur\"] },\r\n    ],\r\n  },\r\n});\r\n// 表格字段\r\nconst columns = [\r\n  {\r\n    type: \"selection\",\r\n    fixed: \"left\",\r\n  },\r\n  {\r\n    title: \"名称\",\r\n    key: \"name\",\r\n  },\r\n  {\r\n    title: \"描述\",\r\n    key: \"description\",\r\n    ellipsis: true,\r\n  },\r\n  {\r\n    title: \"排序\",\r\n    key: \"sort\",\r\n    resizable: true,\r\n  },\r\n  {\r\n    title: \"图标\",\r\n    key: \"icon\",\r\n    render(row) {\r\n      return h(NImage, { width: \"40\", src: row.icon }, {});\r\n    },\r\n  },\r\n  {\r\n    title: \"显示\",\r\n    key: \"state\",\r\n    render(row) {\r\n      if (row.state == 0) {\r\n        return h(\r\n          NTag,\r\n          { type: \"error\" },\r\n          {\r\n            default: () => \"否\",\r\n          }\r\n        );\r\n      } else {\r\n        return h(\r\n          NTag,\r\n          { type: \"info\" },\r\n          {\r\n            default: () => \"是\",\r\n          }\r\n        );\r\n      }\r\n    },\r\n  },\r\n  {\r\n    title: \"浏览量\",\r\n    key: \"views\",\r\n  },\r\n  {\r\n    title: \"收藏量\",\r\n    key: \"likes\",\r\n  },\r\n  {\r\n    title: \"添加时间\",\r\n    key: \"create_time\",\r\n  },\r\n  {\r\n    title: \"操作\",\r\n    key: \"actions\",\r\n    width: \"150\",\r\n    fixed: \"right\",\r\n    render(row) {\r\n        const permission = resolveDirective(\"permission\");\r\n      return h(\r\n        NSpace,\r\n        {},\r\n        {\r\n          default: () => [\r\n            withDirectives(h(\r\n              NButton,\r\n              { size: \"small\",type:\"primary\", onClick: () => editRow(row) },\r\n              { default: () => \"编辑\" }\r\n            ),[[permission, { action: \"nlinks:edit\" }]]\r\n            ),\r\n            withDirectives(h(\r\n              NButton,\r\n              { size: \"small\", type: \"error\", onClick: () => deleteRow(row) },\r\n              { default: () => \"删除\" }\r\n            ),[[permission, { action: \"nlinks:delete\" }]]\r\n            ),\r\n          ],\r\n        }\r\n      );\r\n    },\r\n  },\r\n];\r\n\r\n// 获取页面数据\r\nconst getPageData = () => {\r\n  table.loading = true;\r\n  const params = {\r\n    keyword: search.value,\r\n    menu: search.menu,\r\n    page: pageProps.page,\r\n    pageSize: pageProps.pageSize,\r\n  };\r\n  lList(params).then((res) => {\r\n    table.data = res.data.list.data;\r\n    pageProps.total = res.data.list.total;\r\n    table.loading = false;\r\n  });\r\n};\r\nconst handleSearch = () => {\r\n  pageProps.page = 1;\r\n  getPageData();\r\n};\r\nconst resetSearch = () => {\r\n  pageProps.page = 1;\r\n  search.menu = \"\";\r\n  getPageData();\r\n};\r\nconst getMenusData = () => {\r\n  mList().then((res) => {\r\n    menus.value = res.data.list;\r\n  });\r\n};\r\n\r\nconst getFavicoData = () => {\r\n  lFavicon({ url: modal.form.link }).then((res) => {\r\n    const d = res.data;\r\n    modal.form.name = d.title;\r\n    modal.form.icon = d.ico_url;\r\n    modal.form.description = d.description;\r\n  });\r\n};\r\n\r\n// page update data\r\nconst UpdatePageChange = (a) => {\r\n  pageProps.page = a.page;\r\n  pageProps.pageSize = a.pageSize;\r\n  getPageData();\r\n};\r\nconst addFormData = () => {\r\n  modal.title = \"添加链接\";\r\n  modal.visible = true;\r\n  modal.form = {\r\n    name: \"\",\r\n    icon: \"\",\r\n    description: \"\",\r\n    link: \"\",\r\n    state: 1,\r\n    sort: 100,\r\n    views: 1000,\r\n    likes: 1000,\r\n    menu_id: 1,\r\n  };\r\n};\r\nconst formValidate = (o, callback) => {\r\n  o.value?.validate((errors) => {\r\n    if (!errors) {\r\n      console.log(\"suc\");\r\n      callback && callback();\r\n    } else {\r\n      console.log(errors);\r\n    }\r\n  });\r\n};\r\n// 新增保存\r\nconst formRefs = ref(null);\r\nconst saveFormData = () => {\r\n  formValidate(formRefs, addEditData());\r\n};\r\n// 新增编辑\r\nconst addEditData = async () => {\r\n  const res = modal.form.id ? await lEdit(modal.form) : await lAdd(modal.form);\r\n  if (res.code === 200) (modal.visible = false), getPageData();\r\n  $message.success(res.message);\r\n};\r\n\r\n// 编辑行\r\nconst editRow = (row) => {\r\n  modal.title = \"修改链接\";\r\n  modal.visible = true;\r\n  modal.form = Object.assign({}, row);\r\n};\r\nconst deleteId = (row) => {\r\n  lDelete({ id: row.id }).then((res) => {\r\n    $message.success(res.message);\r\n    getPageData();\r\n  });\r\n};\r\n// 删除行\r\nconst deleteRow = (row) => {\r\n  $dialog.confirm({\r\n    title: \"删除警告\",\r\n    content: \"你确定要删除此链接吗？\",\r\n    confirm() {\r\n      deleteId(row);\r\n    },\r\n    cancel() {\r\n      $message.success(\"取消删除！\");\r\n    },\r\n  });\r\n};\r\n</script>"],"names":["lFavicon","params","request","lList","lAdd","data","lEdit","lDelete","onMounted","getPageData","getMenusData","menus","ref","search","reactive","pageProps","table","modal","columns","row","h","NImage","NTag","permission","resolveDirective","NSpace","withDirectives","NButton","editRow","deleteRow","res","handleSearch","resetSearch","mList","getFavicoData","d","UpdatePageChange","addFormData","formValidate","o","callback","_a","errors","formRefs","saveFormData","addEditData","__async","deleteId"],"mappings":"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"}
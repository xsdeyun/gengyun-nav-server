{"version":3,"file":"33624dc5.js","sources":["../../src/views/system/sysRole.vue"],"sourcesContent":["<template>\r\n  <n-grid x-gap=\"12\" cols=\"1 s:1 m:1 l:5 xl:5 2xl:5\" responsive=\"screen\">\r\n    <n-gi :span=\"3\">\r\n      <div ref=\"pageHeader\" class=\"page-header\">\r\n        <page-search\r\n          v-model:value=\"search.value\"\r\n          @on-search=\"handleSearch()\"\r\n          @on-reset=\"resetSearch()\"\r\n        ></page-search>\r\n      </div>\r\n      <div class=\"page-content\">\r\n        <!-- table strat -->\r\n        <page-table\r\n          :data=\"table.data\"\r\n          :columns=\"table.columns\"\r\n          :loading=\"table.loading\"\r\n          :permission=\"{ action: 'role:add' }\"\r\n          @on-add=\"addFormData\"\r\n          @on-refresh=\"getPageData()\"\r\n          :pagination=\"true\"\r\n          :pageProps=\"pageProps\"\r\n          @on-updatePage=\"UpdatePageChange\"\r\n          @on-checkRow=\"getIdRolesData\"\r\n        >\r\n        </page-table>\r\n        <!-- table end -->\r\n        <!-- model strat -->\r\n        <page-model\r\n          v-model:visible=\"modal.visible\"\r\n          :title=\"modal.title\"\r\n          @on-save=\"saveFormData\"\r\n        >\r\n          <n-form\r\n            ref=\"formRefs\"\r\n            label-placement=\"left\"\r\n            :label-width=\"80\"\r\n            :model=\"modal.form\"\r\n            :rules=\"modal.rules\"\r\n            :show-require-mark=\"true\"\r\n          >\r\n            <n-form-item label=\"角色名称\" path=\"name\">\r\n              <n-input\r\n                v-model:value=\"modal.form.name\"\r\n                placeholder=\"请输入角色名称...\"\r\n              />\r\n            </n-form-item>\r\n            <n-form-item label=\"角色级别\" path=\"level\">\r\n              <n-input-number\r\n                v-model:value=\"modal.form.level\"\r\n                placeholder=\"请输入角色级别...\"\r\n              />\r\n            </n-form-item>\r\n            <n-form-item label=\"备注\" path=\"description\">\r\n              <n-input\r\n                v-model:value=\"modal.form.description\"\r\n                type=\"textarea\"\r\n                placeholder=\"---\"\r\n              />\r\n            </n-form-item>\r\n          </n-form>\r\n        </page-model>\r\n        <!-- model end -->\r\n      </div>\r\n    </n-gi>\r\n    <n-gi :span=\"2\">\r\n      <n-card :bordered=\"false\">\r\n        <template #default>\r\n        <n-tabs type=\"line\" animated>\r\n          <n-tab-pane name=\"菜单权限\">\r\n            <n-tree\r\n              ref=\"menuTree\"\r\n              block-line\r\n              :data=\"treeObj.menus\"\r\n              key-field=\"id\"\r\n              label-field=\"name\"\r\n              checkable\r\n              selectable\r\n              default-expand-all\r\n              v-model:checked-keys=\"treeObj.selectedKeys\"\r\n              check-on-click\r\n              :selected-keys=\"treeObj.selectedKeys\"\r\n              :node-props=\"handleParenChildId\"\r\n              virtual-scroll\r\n              style=\"max-height: calc(100vh - 250px)\"\r\n            />\r\n          </n-tab-pane>\r\n        </n-tabs>\r\n      </template>\r\n        <template #footer>\r\n          <n-button\r\n          class=\"ml-5 mt-5\"\r\n          type=\"primary\"\r\n          size=\"small\"\r\n          v-permission=\"{ action: 'role:save' }\"\r\n          @click=\"updateIdRolesData\"\r\n        >\r\n          保存\r\n        </n-button>\r\n        </template>\r\n      </n-card>\r\n    </n-gi>\r\n  </n-grid>\r\n</template>\r\n<script setup>\r\nimport { onMounted, reactive, h, ref ,  withDirectives, resolveDirective} from \"vue\";\r\nimport {\r\n  rAdd,\r\n  rEdit,\r\n  rDelete,\r\n  rList,\r\n  getIdRoles,\r\n  updateIdRoles,\r\n} from \"@/api/system/role.js\";\r\nimport { mList } from \"@/api/system/menus.js\";\r\nimport { NSpace, NButton } from \"naive-ui\";\r\n// search\r\nconst search = reactive({\r\n  value: \"\",\r\n});\r\nconst treeObj = reactive({\r\n  id: 0,\r\n  menus: [],\r\n  selectedKeys: [],\r\n});\r\n// page\r\nconst pageProps = reactive({\r\n  page: 1,\r\n  pageSize: 10,\r\n  total: 0,\r\n});\r\n// table data\r\nconst table = reactive({\r\n  data: [],\r\n  loading: false,\r\n  columns: [\r\n    {\r\n      type: \"selection\",\r\n      fixed: \"left\",\r\n      multiple: false,\r\n    },\r\n    {\r\n      title: \"名称\",\r\n      key: \"name\",\r\n      width: 150,\r\n    },\r\n    {\r\n      title: \"角色级别\",\r\n      key: \"level\",\r\n      maxWidth: 80,\r\n    },\r\n    {\r\n      title: \"描述\",\r\n      key: \"description\",\r\n      width: 150,\r\n    },\r\n    {\r\n      title: \"操作\",\r\n      key: \"actions\",\r\n      width: 200,\r\n      fixed: \"right\",\r\n      render(row) {\r\n        const permission = resolveDirective(\"permission\");\r\n        return h(\r\n          NSpace,\r\n          {},\r\n          {\r\n            default: () => [\r\n              withDirectives(h(\r\n                NButton,\r\n                { size: \"small\",type:\"primary\", onClick: () => editRow(row) },\r\n                { default: () => \"编辑\" }\r\n              ),\r\n                [[permission, { action: \"role:edit\" }]]\r\n              ),\r\n              withDirectives(h(\r\n                NButton,\r\n                { size: \"small\", type: \"error\", onClick: () => deleteRow(row) },\r\n                { default: () => \"删除\" }\r\n              ),\r\n                [[permission, { action: \"role:delete\" }]]\r\n              ),\r\n            ],\r\n          }\r\n        );\r\n      },\r\n    },\r\n  ],\r\n});\r\n// 弹窗数据\r\nconst modal = reactive({\r\n  title: \"角色新增\",\r\n  visible: false,\r\n  form: {\r\n    name: \"\",\r\n    level: 3,\r\n    description: \"\",\r\n  },\r\n  rules: {\r\n    name: [\r\n      {\r\n        required: true,\r\n        message: \"请输入角色名称！\",\r\n        trigger: [\"input\", \"blur\"],\r\n      },\r\n    ],\r\n  },\r\n});\r\n// initialization\r\nonMounted(() => {\r\n  getPageData();\r\n  getMenusData();\r\n});\r\n\r\nconst handleSearch = () => {\r\n  pageProps.page = 1;\r\n  getPageData();\r\n};\r\nconst resetSearch = () => {\r\n  pageProps.page = 1;\r\n  search.value = \"\";\r\n  getPageData();\r\n};\r\n// get id roles\r\nconst getIdRolesData = (id) => {\r\n  treeObj.id = id;\r\n  getIdRoles({ id: id }).then((res) => {\r\n    treeObj.selectedKeys = res.data.list.map((v) => v.menu_id);\r\n  });\r\n};\r\nconst menuTree = ref(null);\r\nconst updateIdRolesData = () => {\r\n  const CheckedData = menuTree?.value.getCheckedData();\r\n  const IndeterminateData = menuTree?.value.getIndeterminateData();\r\n  const ids = [...CheckedData.keys, ...IndeterminateData.keys];\r\n  updateIdRoles({ role_id: treeObj.id, ids: ids }).then((res) => {\r\n    $message.success(res.message);\r\n    location.reload();\r\n  });\r\n};\r\n// get menus\r\nconst getMenusData = () => {\r\n  mList().then((res) => {\r\n    treeObj.menus = res.data.list;\r\n  });\r\n};\r\n// tree edit\r\nconst handleParenChildId = ({ option }) => {\r\n  return {\r\n    onClick() {\r\n      if (\r\n        treeObj.selectedKeys.indexOf(option.id) != -1 &&\r\n        option.children.length\r\n      ) {\r\n        const childs = option.children.map((c) => c.id);\r\n        treeObj.selectedKeys = [...treeObj.selectedKeys, ...childs];\r\n      } else {\r\n        const childs = option.children.map((c) => c.id);\r\n        for (var i = 0; i < treeObj.selectedKeys.length; i++) {\r\n          if (childs.includes(treeObj.selectedKeys[i])) {\r\n            treeObj.selectedKeys.splice(i, 1);\r\n            i--; \r\n          }\r\n        }\r\n      }\r\n    },\r\n  };\r\n};\r\n// get roles\r\nconst getPageData = () => {\r\n  table.loading = true;\r\n  const params = {\r\n    keyword: search.value,\r\n    page: pageProps.page,\r\n    pageSize: pageProps.pageSize,\r\n  };\r\n  rList(params).then((res) => {\r\n    table.data = res.data.list.data;\r\n    pageProps.total = res.data.list.total;\r\n    table.loading = false;\r\n  });\r\n};\r\n// page update data\r\nconst UpdatePageChange = (a) => {\r\n  pageProps.page = a.page;\r\n  pageProps.pageSize = a.pageSize;\r\n  getPageData();\r\n};\r\n// add roles\r\nconst addFormData = () => {\r\n  modal.title = \"角色新增\";\r\n  modal.visible = true;\r\n  modal.form = {\r\n    name: \"\",\r\n    level: 3,\r\n    description: \"\",\r\n  };\r\n};\r\n// edit row\r\nconst editRow = (row) => {\r\n  modal.title = \"角色编辑\";\r\n  modal.visible = true;\r\n  modal.form = Object.assign({}, row);\r\n};\r\n// delete\r\nconst deleteId = (row) => {\r\n  rDelete({ id: row.id }).then((res) => {\r\n    $message.success(res.message);\r\n    getPageData();\r\n  });\r\n};\r\n// data delete\r\nconst deleteRow = (row) => {\r\n  $dialog.confirm({\r\n    title: \"删除警告\",\r\n    content: \"你确定要删除此角色吗？\",\r\n    confirm() {\r\n      deleteId(row);\r\n    },\r\n    cancel() {\r\n      $message.success(\"取消删除！\");\r\n    },\r\n  });\r\n};\r\n// validate rules\r\nconst formValidate = (o, callback) => {\r\n  o.value?.validate((errors) => {\r\n    if (!errors) {\r\n      console.log(\"suc\");\r\n      callback && callback();\r\n    } else {\r\n      console.log(errors);\r\n    }\r\n  });\r\n};\r\n// save form\r\nconst saveFormData = () => {\r\n  const formRefs = ref(null);\r\n  formValidate(formRefs, addEditData());\r\n};\r\nconst addEditData = async () => {\r\n  const res = modal.form.id ? await rEdit(modal.form) : await rAdd(modal.form);\r\n  if (res.code === 200) (modal.visible = false), getPageData();\r\n  $message.success(res.message);\r\n};\r\n</script>\r\n<style scoped>\r\n\r\n</style>"],"names":["search","reactive","treeObj","pageProps","table","row","permission","resolveDirective","h","NSpace","withDirectives","NButton","editRow","deleteRow","modal","onMounted","getPageData","getMenusData","handleSearch","resetSearch","getIdRolesData","id","getIdRoles","res","v","menuTree","ref","updateIdRolesData","CheckedData","IndeterminateData","ids","updateIdRoles","mList","handleParenChildId","option","childs","c","i","params","rList","UpdatePageChange","a","addFormData","deleteId","rDelete","formValidate","o","callback","_a","errors","saveFormData","formRefs","addEditData","__async","rEdit","rAdd"],"mappings":"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"}
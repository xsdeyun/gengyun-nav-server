var R=(D,g,s)=>new Promise((c,p)=>{var a=u=>{try{v(s.next(u))}catch(r){p(r)}},h=u=>{try{v(s.throw(u))}catch(r){p(r)}},v=u=>u.done?c(u.value):Promise.resolve(u.value).then(a,h);v((s=s.apply(D,g)).next())});import{r as Z,g as T,u as ee,a as te,b as ae,c as se}from"./3cec01e0.js";import{m as le}from"./e9ce021d.js";import{h as _,q as C,y as b,x as k,A as x,B as ne,o as oe,r as O,a as o,b as S,l as z,w as i,e as l,d as I,f as ie,j as de}from"./0ae629d1.js";const re={ref:"pageHeader",class:"page-header"},ce={class:"page-content"},ge={__name:"sysRole",setup(D){const g=_({value:""}),s=_({id:0,menus:[],selectedKeys:[]}),c=_({page:1,pageSize:10,total:0}),p=_({data:[],loading:!1,columns:[{type:"selection",fixed:"left",multiple:!1},{title:"名称",key:"name",width:150},{title:"角色级别",key:"level",maxWidth:80},{title:"描述",key:"description",width:150},{title:"操作",key:"actions",width:200,fixed:"right",render(t){const e=C("permission");return b(ne,{},{default:()=>[k(b(x,{size:"small",type:"primary",onClick:()=>V(t)},{default:()=>"编辑"}),[[e,{action:"role:edit"}]]),k(b(x,{size:"small",type:"error",onClick:()=>q(t)},{default:()=>"删除"}),[[e,{action:"role:delete"}]])]})}}]}),a=_({title:"角色新增",visible:!1,form:{name:"",level:3,description:""},rules:{name:[{required:!0,message:"请输入角色名称！",trigger:["input","blur"]}]}});oe(()=>{f(),$()});const h=()=>{c.page=1,f()},v=()=>{c.page=1,g.value="",f()},u=t=>{s.id=t,T({id:t}).then(e=>{s.selectedKeys=e.data.list.map(d=>d.menu_id)})},r=O(null),U=()=>{const t=r==null?void 0:r.value.getCheckedData(),e=r==null?void 0:r.value.getIndeterminateData(),d=[...t.keys,...e.keys];ee({role_id:s.id,ids:d}).then(m=>{$message.success(m.message),location.reload()})},$=()=>{le().then(t=>{s.menus=t.data.list})},P=({option:t})=>({onClick(){if(s.selectedKeys.indexOf(t.id)!=-1&&t.children.length){const d=t.children.map(m=>m.id);s.selectedKeys=[...s.selectedKeys,...d]}else{const d=t.children.map(m=>m.id);for(var e=0;e<s.selectedKeys.length;e++)d.includes(s.selectedKeys[e])&&(s.selectedKeys.splice(e,1),e--)}}}),f=()=>{p.loading=!0;const t={keyword:g.value,page:c.page,pageSize:c.pageSize};Z(t).then(e=>{p.data=e.data.list.data,c.total=e.data.list.total,p.loading=!1})},B=t=>{c.page=t.page,c.pageSize=t.pageSize,f()},N=()=>{a.title="角色新增",a.visible=!0,a.form={name:"",level:3,description:""}},V=t=>{a.title="角色编辑",a.visible=!0,a.form=Object.assign({},t)},j=t=>{te({id:t.id}).then(e=>{$message.success(e.message),f()})},q=t=>{$dialog.confirm({title:"删除警告",content:"你确定要删除此角色吗？",confirm(){j(t)},cancel(){$message.success("取消删除！")}})},A=(t,e)=>{var d;(d=t.value)==null||d.validate(m=>{m?console.log(m):(console.log("suc"),e&&e())})},E=()=>{const t=O(null);A(t,F())},F=()=>R(this,null,function*(){const t=a.form.id?yield ae(a.form):yield se(a.form);t.code===200&&(a.visible=!1,f()),$message.success(t.message)});return(t,e)=>{const d=o("page-search"),m=o("page-table"),w=o("n-input"),y=o("n-form-item"),L=o("n-input-number"),M=o("n-form"),H=o("page-model"),K=o("n-gi"),W=o("n-tree"),G=o("n-tab-pane"),J=o("n-tabs"),Q=o("n-card"),X=o("n-grid"),Y=C("permission");return S(),z(X,{"x-gap":"12",cols:"1 s:1 m:1 l:5 xl:5 2xl:5",responsive:"screen"},{default:i(()=>[l(K,{span:3},{default:i(()=>[I("div",re,[l(d,{value:g.value,"onUpdate:value":e[0]||(e[0]=n=>g.value=n),onOnSearch:e[1]||(e[1]=n=>h()),onOnReset:e[2]||(e[2]=n=>v())},null,8,["value"])],512),I("div",ce,[l(m,{data:p.data,columns:p.columns,loading:p.loading,permission:{action:"role:add"},onOnAdd:N,onOnRefresh:e[3]||(e[3]=n=>f()),pagination:!0,pageProps:c,onOnUpdatePage:B,onOnCheckRow:u},null,8,["data","columns","loading","pageProps"]),l(H,{visible:a.visible,"onUpdate:visible":e[7]||(e[7]=n=>a.visible=n),title:a.title,onOnSave:E},{default:i(()=>[l(M,{ref:"formRefs","label-placement":"left","label-width":80,model:a.form,rules:a.rules,"show-require-mark":!0},{default:i(()=>[l(y,{label:"角色名称",path:"name"},{default:i(()=>[l(w,{value:a.form.name,"onUpdate:value":e[4]||(e[4]=n=>a.form.name=n),placeholder:"请输入角色名称..."},null,8,["value"])]),_:1}),l(y,{label:"角色级别",path:"level"},{default:i(()=>[l(L,{value:a.form.level,"onUpdate:value":e[5]||(e[5]=n=>a.form.level=n),placeholder:"请输入角色级别..."},null,8,["value"])]),_:1}),l(y,{label:"备注",path:"description"},{default:i(()=>[l(w,{value:a.form.description,"onUpdate:value":e[6]||(e[6]=n=>a.form.description=n),type:"textarea",placeholder:"---"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title"])])]),_:1}),l(K,{span:2},{default:i(()=>[l(Q,{bordered:!1},{default:i(()=>[l(J,{type:"line",animated:""},{default:i(()=>[l(G,{name:"菜单权限"},{default:i(()=>[l(W,{ref_key:"menuTree",ref:r,"block-line":"",data:s.menus,"key-field":"id","label-field":"name",checkable:"",selectable:"","default-expand-all":"","checked-keys":s.selectedKeys,"onUpdate:checkedKeys":e[8]||(e[8]=n=>s.selectedKeys=n),"check-on-click":"","selected-keys":s.selectedKeys,"node-props":P,"virtual-scroll":"",style:{"max-height":"calc(100vh - 250px)"}},null,8,["data","checked-keys","selected-keys"])]),_:1})]),_:1})]),footer:i(()=>[k((S(),z(ie(x),{class:"ml-5 mt-5",type:"primary",size:"small",onClick:U},{default:i(()=>[de(" 保存 ")]),_:1})),[[Y,{action:"role:save"}]])]),_:1})]),_:1})]),_:1})}}};export{ge as default};
//# sourceMappingURL=33624dc5.js.map
